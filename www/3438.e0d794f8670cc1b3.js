"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3438],{3438:(W,h,l)=>{l.r(h),l.d(h,{Tab2PageModule:()=>w});var c=l(4742),a=l(177),d=l(4341),L=l(1307),b=l(5260),f=l(467),S=l(5558),T=l(6354),t=l(4438),m=l(5923);const C=(e,s)=>({"in-frigo":e,"not-in-frigo":s});function R(e,s){if(1&e){const o=t.RV6();t.j41(0,"ion-button",1),t.bIt("click",function(){t.eBV(o);const n=t.XpG().$implicit,r=t.XpG();return t.Njj(r.addToFridge(n.ingredient))}),t.EFF(1,"Ajouter au frigo"),t.k0s()}}function v(e,s){if(1&e&&(t.j41(0,"ion-item",4)(1,"ion-label"),t.EFF(2),t.k0s(),t.DNE(3,R,2,0,"ion-button",5),t.k0s()),2&e){const o=s.$implicit;t.Y8G("ngClass",t.l_i(3,C,o.inFrigo,!o.inFrigo)),t.R7$(2),t.JRh(o.ingredient),t.R7$(),t.Y8G("ngIf",!o.inFrigo)}}let F=(()=>{var e;class s{constructor(i,n){this.modalController=i,this.frigoService=n,this.shoppingList=[]}ngOnInit(){this.updateShoppingListStatus()}updateShoppingListStatus(){this.frigoService.getCurrentIngredients().subscribe(i=>{this.shoppingList.forEach(n=>{n.inFrigo=i.some(r=>r.toLowerCase()===n.ingredient.toLowerCase())})})}addToFridge(i){this.frigoService.addIngredient(i).subscribe(()=>{console.log(`Ingr\xe9dient ${i} ajout\xe9 au frigo`),this.updateShoppingListStatus()},n=>console.error(`Erreur lors de l'ajout de l'ingr\xe9dient ${i} au frigo`,n))}closeModal(i){this.modalController.dismiss({action:i})}}return(e=s).\u0275fac=function(i){return new(i||e)(t.rXU(c.W3),t.rXU(m.L))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-shopping-list-modal"]],inputs:{shoppingList:"shoppingList"},decls:14,vars:1,consts:[["slot","end"],[3,"click"],[3,"ngClass",4,"ngFor","ngForOf"],["expand","block",3,"click"],[3,"ngClass"],[3,"click",4,"ngIf"]],template:function(i,n){1&i&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t.EFF(3,"Liste de courses"),t.k0s(),t.j41(4,"ion-buttons",0)(5,"ion-button",1),t.bIt("click",function(){return n.closeModal("reduce")}),t.EFF(6,"Fermer"),t.k0s()()()(),t.j41(7,"ion-content")(8,"ion-list"),t.DNE(9,v,4,6,"ion-item",2),t.k0s()(),t.j41(10,"ion-footer")(11,"ion-toolbar")(12,"ion-button",3),t.bIt("click",function(){return n.closeModal("reduce")}),t.EFF(13,"R\xe9duire"),t.k0s()()()),2&i&&(t.R7$(9),t.Y8G("ngForOf",n.shoppingList))},dependencies:[a.YU,a.Sq,a.bT,c.Jm,c.QW,c.W9,c.M0,c.eU,c.uz,c.he,c.nf,c.BC,c.ai],styles:[".shopping-list-bubble[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background-color:#fff;padding:20px;border-radius:10px;box-shadow:0 0 10px #0003;width:300px;max-width:80%;z-index:1}.expanded[_ngcontent-%COMP%]{height:300px;overflow-y:auto}.shopping-list-bubble[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.shopping-list-bubble[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:10px;border-bottom:1px solid #ccc}.shopping-list-bubble[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{border-bottom:none}.shopping-list-bubble[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{position:absolute;bottom:10px;right:10px}.reduced[_ngcontent-%COMP%]{height:50px;width:50px;position:fixed;top:10px;right:10px;border-radius:50%;background-color:red;display:flex;justify-content:center;align-items:center;cursor:pointer}.reduced-indicator[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;justify-content:center;align-items:center}.reduced-indicator[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px;color:#fff}.in-frigo[_ngcontent-%COMP%]{--background: rgba(0, 255, 0, .1)}.not-in-frigo[_ngcontent-%COMP%]{--background: rgba(255, 0, 0, .1)}"]}),s})();var M=l(5530),k=l(4412);let P=(()=>{var e;class s{constructor(){this.userShoppingListSource=new k.t([]),this.userShoppingList$=this.userShoppingListSource.asObservable()}updateUserShoppingList(i){this.userShoppingListSource.next(i)}getUserShoppingList(){return this.userShoppingListSource.value}}return(e=s).\u0275fac=function(i){return new(i||e)},e.\u0275prov=t.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}),s})();const j=(e,s)=>({"in-frigo":e,"not-in-frigo":s});function I(e,s){if(1&e){const o=t.RV6();t.j41(0,"ion-button",4),t.bIt("click",function(){t.eBV(o);const n=t.XpG();return t.Njj(n.expandShoppingList())}),t.EFF(1," VOIR LA LISTE DE COURSES "),t.k0s()}}function x(e,s){if(1&e){const o=t.RV6();t.j41(0,"div",5),t.bIt("click",function(){t.eBV(o);const n=t.XpG();return t.Njj(n.expandShoppingList())}),t.nrm(1,"ion-icon",6),t.k0s()}}function E(e,s){if(1&e){const o=t.RV6();t.j41(0,"ion-button",10),t.bIt("click",function(){t.eBV(o);const n=t.XpG().$implicit,r=t.XpG(2);return t.Njj(r.addToFridge(n.ingredient))}),t.EFF(1,"Add to Fridge"),t.k0s()}}function $(e,s){if(1&e&&(t.j41(0,"ion-item",8)(1,"ion-label"),t.EFF(2),t.k0s(),t.DNE(3,E,2,0,"ion-button",9),t.k0s()),2&e){const o=s.$implicit;t.Y8G("ngClass",t.l_i(3,j,o.inFrigo,!o.inFrigo)),t.R7$(2),t.JRh(o.ingredient),t.R7$(),t.Y8G("ngIf",!o.inFrigo)}}function O(e,s){if(1&e){const o=t.RV6();t.j41(0,"ion-button",4),t.bIt("click",function(){t.eBV(o);const n=t.XpG(2);return t.Njj(n.saveShoppingList())}),t.EFF(1," SAVE "),t.k0s()}}function y(e,s){if(1&e){const o=t.RV6();t.j41(0,"ion-list")(1,"ion-list-header")(2,"ion-label"),t.EFF(3,"Liste de courses"),t.k0s()(),t.DNE(4,$,4,6,"ion-item",7),t.j41(5,"ion-button",4),t.bIt("click",function(){t.eBV(o);const n=t.XpG();return t.Njj(n.clearShoppingList())}),t.EFF(6,"Vider"),t.k0s(),t.DNE(7,O,2,0,"ion-button",1),t.k0s()}if(2&e){const o=t.XpG();t.R7$(4),t.Y8G("ngForOf",o.shoppingList),t.R7$(3),t.Y8G("ngIf",o.shoppingList.length>0)}}function G(e,s){1&e&&(t.j41(0,"ion-item"),t.EFF(1," La liste de courses est vide. "),t.k0s())}function V(e,s){if(1&e){const o=t.RV6();t.j41(0,"ion-button",4),t.bIt("click",function(){t.eBV(o);const n=t.XpG();return t.Njj(n.createShoppingList())}),t.EFF(1," CR\xc9ER UNE LISTE DE COURSES "),t.k0s()}}function N(e,s){if(1&e){const o=t.RV6();t.j41(0,"ion-item")(1,"ion-checkbox",12),t.mxI("ngModelChange",function(n){const r=t.eBV(o).$implicit;return t.DH7(r.selected,n)||(r.selected=n),t.Njj(n)}),t.bIt("ionChange",function(){t.eBV(o);const n=t.XpG(2);return t.Njj(n.updateSelectedRecettes())}),t.k0s(),t.j41(2,"ion-label",13),t.EFF(3),t.k0s(),t.j41(4,"ion-label"),t.EFF(5),t.k0s(),t.j41(6,"ion-button",14),t.bIt("click",function(){const n=t.eBV(o).$implicit,r=t.XpG(2);return t.Njj(r.showRecetteDetails(n))}),t.nrm(7,"ion-icon",15),t.k0s()()}if(2&e){const o=s.$implicit;t.R7$(),t.R50("ngModel",o.selected),t.R7$(2),t.Lme("",o.disponibles,"/",o.total,""),t.R7$(2),t.JRh(o.titre)}}function U(e,s){if(1&e&&(t.j41(0,"ion-list"),t.DNE(1,N,8,4,"ion-item",11),t.k0s()),2&e){const o=t.XpG();t.R7$(),t.Y8G("ngForOf",o.recettes)}}function X(e,s){1&e&&(t.j41(0,"ion-item"),t.EFF(1," Aucune recette disponible. "),t.k0s())}const Y=[{path:"",component:(()=>{var e;class s{constructor(i,n,r,g,p,u){this.recetteService=i,this.frigoService=n,this.alertController=r,this.cdr=g,this.modalController=p,this.shoppingListService=u,this.recettes=[],this.selectedRecettes=[],this.shoppingList=[],this.isReducedIconVisible=!1,this.savedShoppingList=[]}ngOnInit(){console.log("Tab2 ngOnInit called"),this.loadRecettesWithAvailability()}loadRecettesWithAvailability(){console.log("D\xe9but du chargement des recettes"),this.recetteService.getTitres().pipe((0,S.n)(i=>this.frigoService.getCurrentIngredients().pipe((0,T.T)(n=>({recettes:i,frigoIngredients:n}))))).subscribe(({recettes:i,frigoIngredients:n})=>{console.log("Recettes re\xe7ues:",i),console.log("Ingr\xe9dients du frigo re\xe7us:",n);const r=i.map(g=>{const p=g.ingredients.split(",").map(_=>_.trim()),u=p.filter(_=>n.some(A=>A.toLowerCase()===_.toLowerCase())).length;return console.log(`Recette ${g.titre}: ${u}/${p.length} ingr\xe9dients disponibles`),{...g,selected:!1,disponibles:u,total:p.length}});console.log("Recettes avec disponibilit\xe9:",r),this.recettes=r,console.log("this.recettes mis \xe0 jour:",this.recettes),this.cdr.detectChanges()},i=>console.error("Erreur lors du chargement des recettes",i))}updateSelectedRecettes(){this.selectedRecettes=this.recettes.filter(i=>i.selected),console.log("Recettes s\xe9lectionn\xe9es:",this.selectedRecettes)}createShoppingList(){console.log("Cr\xe9ation de la liste de courses"),this.shoppingList=[],this.selectedRecettes.forEach(i=>{i.ingredients.split(",").map(r=>r.trim()).forEach(r=>{this.shoppingList.some(g=>g.ingredient===r)||this.shoppingList.push({ingredient:r,inFrigo:!1})})}),this.frigoService.getCurrentIngredients().subscribe(i=>{this.shoppingList.forEach(n=>{n.inFrigo=i.some(r=>r.toLowerCase()===n.ingredient.toLowerCase())})})}showRecetteDetails(i){var n=this;return(0,f.A)(function*(){console.log("full card affichage");const r=yield n.recetteService.getRecetteDetails(i.id).toPromise();yield(yield n.alertController.create({header:r.titre,message:`\n        Type: ${r.type}<br>\n        Prix: ${r.prix}<br>\n        Temps: ${r.temps} minutes<br>\n        Ingr\xe9dients: ${r.ingredients}<br>\n        \xc9tapes: ${r.etapes}<br>\n        Notes: ${r.notes||"Aucune"}\n      `,buttons:["OK"]})).present()})()}addToFridge(i){this.frigoService.addIngredient(i).subscribe(()=>{console.log(`Ingr\xe9dient ${i} ajout\xe9 au frigo`),this.loadRecettesWithAvailability()},n=>console.error(`Erreur lors de l'ajout de l'ingr\xe9dient ${i} au frigo`,n))}isIngredientInFridge(i){return this.shoppingList.some(n=>n.ingredient===i&&n.inFrigo)}clearShoppingList(){this.shoppingList=[],console.log("Liste de courses vid\xe9e")}saveShoppingList(){this.shoppingListService.updateUserShoppingList([...this.shoppingList]),this.isReducedIconVisible=!0,this.shoppingList=[]}openShoppingListModal(){var i=this;return(0,f.A)(function*(){const n=yield i.modalController.create({component:F,componentProps:{shoppingList:i.shoppingListService.getUserShoppingList()}});return n.onDidDismiss().then(r=>{r.data&&"reduce"===r.data.action&&(i.isReducedIconVisible=!0)}),yield n.present()})()}emptyShoppingList(){this.shoppingList=[],this.isReducedIconVisible=!0}expandShoppingList(){this.isReducedIconVisible=!1,this.openShoppingListModal()}}return(e=s).\u0275fac=function(i){return new(i||e)(t.rXU(M.S),t.rXU(m.L),t.rXU(c.hG),t.rXU(t.gRc),t.rXU(c.W3),t.rXU(P))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-tab2"]],decls:12,vars:8,consts:[[3,"fullscreen"],["expand","block",3,"click",4,"ngIf"],["class","reduced-icon",3,"click",4,"ngIf"],[4,"ngIf"],["expand","block",3,"click"],[1,"reduced-icon",3,"click"],["name","cart "],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[3,"click",4,"ngIf"],[3,"click"],[4,"ngFor","ngForOf"],[3,"ngModelChange","ionChange","ngModel"],[1,"availability"],["fill","clear",3,"click"],["name","help-circle-outline"]],template:function(i,n){1&i&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t.EFF(3,"Toutes les Recettes"),t.k0s()()(),t.j41(4,"ion-content",0),t.DNE(5,I,2,0,"ion-button",1)(6,x,2,0,"div",2)(7,y,8,2,"ion-list",3)(8,G,2,0,"ion-item",3)(9,V,2,0,"ion-button",1)(10,U,2,1,"ion-list",3)(11,X,2,0,"ion-item",3),t.k0s()),2&i&&(t.R7$(4),t.Y8G("fullscreen",!0),t.R7$(),t.Y8G("ngIf",n.isReducedIconVisible),t.R7$(),t.Y8G("ngIf",n.isReducedIconVisible),t.R7$(),t.Y8G("ngIf",n.shoppingList.length>0),t.R7$(),t.Y8G("ngIf",0===n.shoppingList.length&&n.selectedRecettes.length>0),t.R7$(),t.Y8G("ngIf",n.selectedRecettes.length>0),t.R7$(),t.Y8G("ngIf",n.recettes&&n.recettes.length>0),t.R7$(),t.Y8G("ngIf",!n.recettes||0===n.recettes.length))},dependencies:[c.Jm,c.eY,c.W9,c.eU,c.iq,c.uz,c.he,c.nf,c.AF,c.BC,c.ai,c.hB,a.YU,a.Sq,a.bT,d.BC,d.vS],styles:["ion-content[_ngcontent-%COMP%]{--overflow: auto}ion-list[_ngcontent-%COMP%]{padding-bottom:20px}ion-item[_ngcontent-%COMP%]   .availability[_ngcontent-%COMP%]{min-width:50px;text-align:center;font-size:.9em;color:var(--ion-color-medium)}.in-frigo[_ngcontent-%COMP%]{--background: rgba(0, 255, 0, .1)}.not-in-frigo[_ngcontent-%COMP%]{--background: rgba(255, 0, 0, .1)}"]}),s})()}];let D=(()=>{var e;class s{}return(e=s).\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.$C({type:e}),e.\u0275inj=t.G2t({imports:[b.iI.forChild(Y),b.iI]}),s})(),B=(()=>{var e;class s{}return(e=s).\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.$C({type:e}),e.\u0275inj=t.G2t({imports:[a.MD,c.bv,d.YN]}),s})(),w=(()=>{var e;class s{}return(e=s).\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.$C({type:e}),e.\u0275inj=t.G2t({imports:[c.bv,a.MD,d.YN,L.S,D,B]}),s})()}}]);