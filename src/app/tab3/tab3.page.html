<app-header [back]="false" [menu]="true" [settings]="true" title="{{frigosResults?.nom}}"></app-header>
<ion-content [fullscreen]="true" [class.content-hidden]="scanning">

  <div class="fab-container">
    <ion-fab slot="fixed" vertical="bottom" horizontal="end" edge #fabComponent>
      <ion-fab-button>
        <ion-icon name="chevron-up-circle"></ion-icon>

      </ion-fab-button>
      <ion-fab-list side="top">

        <ion-fab-button id="present-alert" data-desc="Supprimer la cuisine">
          <ion-icon name="trash-outline"></ion-icon>
        </ion-fab-button>

        <ion-fab-button id="open-modal-add" data-desc="Ajouter un ingrédient">
          <ion-icon name="add"></ion-icon>
        </ion-fab-button>

        <ion-fab-button (click)="startScan()" data-desc="Scanner un ingrédient">
          <ion-icon name="barcode-outline"></ion-icon>

        </ion-fab-button>

        <ion-fab-button id="open-modal-shared" data-desc="Partager la cuisine">
          <ion-icon name="share-outline"></ion-icon>
        </ion-fab-button>

      </ion-fab-list>
    </ion-fab>
  </div>

  <ion-list>
    <ion-item *ngFor="let ingredient of frigosResults?.ingredients">
      <ion-label>{{ ingredient.ingredient }}</ion-label> <!-- Ajusté selon l'interface Ingredient -->
      <span>Quantity: {{ ingredient.frigo_ingredients.quantity }}</span> <!-- Ajusté selon l'interface Ingredient -->
      <ion-button slot="end" color="danger" (click)="removeIngredient(ingredient.id)">
        <ion-icon name="trash"></ion-icon>
      </ion-button>
    </ion-item>
  </ion-list>

  <ion-list lines="none" style="text-align:center; padding-top:40%;" *ngIf="frigosResults?.ingredients?.length === 0">

    <h2>{{ 'Votre cuisine est vide!' | translate }}</h2>

    <button [swal]="['Oops!', 'This is not implemented yet :/', 'warning']">
      Do it!
    </button>

    <app-lottie animation="man"></app-lottie>

    <br />
    <ion-item style="text-align:center;">
      <p>{{ 'Cliquez sur le bouton en bas à droite pour ajouter ou scanner des ingrédients' | translate }}</p>
    </ion-item>
    <img style="transform: rotate(180deg)" src="assets/images/arrow.png" width="50%" />
  </ion-list>


  <ion-modal class="root" [isOpen]="isModalOpen">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>{{ 'SCANNED_PRODUCT' | translate }}</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeModal()">{{ 'CLOSE' | translate }}</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-img *ngIf="scannedProduct?.image_url" [src]="scannedProduct.image_url" alt="Image du produit">
        </ion-img>
        <h2>{{ scannedProduct?.product_name }}</h2>
        <p>{{ 'BRAND' | translate }}: {{ scannedProduct?.brands }}</p>
        <p>{{ 'ADDITIVES' | translate }}: {{ scannedProduct?.additives }}</p>
        <p>{{ 'TRACES' | translate }}: {{ scannedProduct?.traces }}</p>
        <p>{{ 'NUTRITION_GRADES' | translate }}: {{ scannedProduct?.nutrition_grades }}</p>
        <p>{{ 'CONTAINS' | translate }}: {{ scannedProduct?.contains }}</p>
        <p>{{ 'DOES_NOT_CONTAIN' | translate }}: {{ scannedProduct?.does_not_contain }}</p>
        <p>{{ 'STATES' | translate }}: {{ scannedProduct?.states }}</p>
        <p>{{ 'QUANTITY' | translate }}: {{ scannedProduct?.quantity }}</p>
        <ion-button expand="block" (click)="addToFridge()">{{ 'ADD_TO_FRIDGE' | translate }}</ion-button>
      </ion-content>
    </ng-template>
  </ion-modal>

  <ion-modal #modalShared trigger="open-modal-shared">
    <ng-template>
      <div class="block">
        <ion-toolbar>
          <ion-title>Partager la cuisine</ion-title>
          <ion-buttons slot="end">
            <ion-button color="light" (click)="modalShared.dismiss()">Fermer</ion-button>
          </ion-buttons>
        </ion-toolbar>

        <ion-list lines="none" style="text-align:center">


          <app-lottie animation="searching-food"></app-lottie>
          <ion-item style="text-align:center">
            <p>En partageant cette cuisine avec un utilisateur, il aura accès à son contenu, les recettes favorites,
              ainsi que les listes de courses liés.</p>
          </ion-item>
          <ion-item>
            <ion-select class="form-control" justify="space-between" label="Selectionner un/des utilisateurs"
              placeholder="utilisateur(s)" [(ngModel)]="selectedUsers" id="category" cancelText="Cancel" okText="Ok"
              multiple="true" [value]="">
              <ion-select-option *ngFor="let item of usersResults" [value]="item.id">{{item.username}}
              </ion-select-option>

            </ion-select>
          </ion-item>
          <ion-button (click)="shareFridge()" [disabled]="selectedUsers.length === 0" style="align-items: center;">{{
            'SHARED' | translate }}</ion-button>
        </ion-list>
      </div>
    </ng-template>
  </ion-modal>

  <ion-modal #modalAdd trigger="open-modal-add">
    <ng-template>
      <div class="block">
        <ion-toolbar>
          <ion-title>Ajouter un ingrédient</ion-title>
          <ion-buttons slot="end">
            <ion-button color="light" (click)="modalAdd.dismiss()">Fermer</ion-button>
          </ion-buttons>
        </ion-toolbar>
        <form name="form" name="form" (ngSubmit)="f.form.valid && onSubmit()" #f="ngForm" novalidate>
          <ion-list style="text-align:center" lines="none">
            <app-lottie animation="enjoy-food"></app-lottie>
            <ion-item style="text-align:center">
              <p>Ajouter un ingrédient à votre cuisine parmis la liste, et préciser sa quantité.</p>
            </ion-item>
            <ion-item>
              <select class="form-control" name="name" required [(ngModel)]="form.ingredient" class="form-control">
                <option *ngFor="let ingredient of ingredientsResults;" [ngValue]="ingredient">
                  {{ingredient.ingredient}}
                </option>
              </select>
            </ion-item>
            <ion-item>
              <ion-input inputmode="decimal" type="number" label="Quantity" placeholder="Enter quantity"
                class="form-control" name="quantity" [(ngModel)]="form.quantity"></ion-input>
            </ion-item>
            <ion-item>
              <select class="form-control" name="mesure" required [(ngModel)]="form.mesure" class="form-control">
                <option *ngFor="let mesure of mesuresResults;" [ngValue]="mesure">
                  {{mesure.name}}
                </option>
              </select>
            </ion-item>
            <ion-button style="align-items: center;" [disabled]="!f.form.valid" (click)="onSubmit()">Ajouter
            </ion-button>
          </ion-list>
        </form>
      </div>
    </ng-template>
  </ion-modal>

  <ion-alert trigger="present-alert"
    header="Etes vous sur de supprimer ce frigo ainsi que les ingrédients qu'il contient ?" [buttons]="alertButtons">
  </ion-alert>

</ion-content>