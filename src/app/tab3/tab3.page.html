<app-header [back]="false" [menu]="true" title="{{currentFrigo?.nom}}"></app-header>
<ion-content [fullscreen]="true" [class.content-hidden]="scanning">

  <div class="fab-container">
    <ion-fab slot="fixed" vertical="bottom" horizontal="end" edge #fabComponent>
      <ion-fab-button>
        <ion-icon name="chevron-up-circle"></ion-icon>

      </ion-fab-button>
      <ion-fab-list side="top">

        <ion-fab-button id="present-alert" data-desc="Supprimer le frigo">
          <ion-icon name="trash-outline"></ion-icon>
        </ion-fab-button>

        <ion-fab-button id="open-modal-add" data-desc="Ajouter un ingrédient">
          <ion-icon name="add"></ion-icon>
        </ion-fab-button>

        <ion-fab-button (click)="startScan()" data-desc="Scanner un ingrédient">
          <ion-icon name="barcode-outline"></ion-icon>

        </ion-fab-button>

        <ion-fab-button id="open-modal-shared" data-desc="Partager le frigo">
          <ion-icon name="share-outline"></ion-icon>
        </ion-fab-button>

      </ion-fab-list>
    </ion-fab>
  </div>

  <ion-list>
    <ion-item *ngFor="let ingredient of currentFrigo?.ingredients">
      <ion-label>{{ ingredient.nom }}</ion-label> <!-- Ajusté selon l'interface Ingredient -->
      <ion-button slot="end" color="danger" (click)="removeIngredient(ingredient.id)">
        <ion-icon name="trash"></ion-icon>
      </ion-button>
    </ion-item>
  </ion-list>

  <ion-list style="text-align:center; padding-top:40%;" *ngIf="currentFrigo?.ingredients?.length === 0">

    <h2>{{ 'Votre cuisine est vide!' | translate }}</h2>



    <app-lottie animation="man"></app-lottie>

    <br />
    <span>{{ 'Cliquez sur le bouton en bas à droite pour ajouter ou scanner des ingrédients' | translate }}</span>
    <br />
    <img style="transform: rotate(180deg)" src="assets/images/arrow.png" width="50%" />
  </ion-list>
  <!--   <ion-item>
        <ion-input [(ngModel)]="newIngredient" [placeholder]="'NEW_INGREDIENT_PLACEHOLDER' | translate"></ion-input>
        <ion-button (click)="addIngredient()">{{ 'ADD_INGREDIENT' | translate }}</ion-button>
      </ion-item>
    -->


  <ion-modal class="root" [isOpen]="isModalOpen">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>{{ 'SCANNED_PRODUCT' | translate }}</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeModal()">{{ 'CLOSE' | translate }}</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-img *ngIf="scannedProduct?.image_url" [src]="scannedProduct.image_url" alt="Image du produit">
        </ion-img>
        <h2>{{ scannedProduct?.product_name }}</h2>
        <p>{{ 'BRAND' | translate }}: {{ scannedProduct?.brands }}</p>
        <p>{{ 'ADDITIVES' | translate }}: {{ scannedProduct?.additives }}</p>
        <p>{{ 'TRACES' | translate }}: {{ scannedProduct?.traces }}</p>
        <p>{{ 'NUTRITION_GRADES' | translate }}: {{ scannedProduct?.nutrition_grades }}</p>
        <p>{{ 'CONTAINS' | translate }}: {{ scannedProduct?.contains }}</p>
        <p>{{ 'DOES_NOT_CONTAIN' | translate }}: {{ scannedProduct?.does_not_contain }}</p>
        <p>{{ 'STATES' | translate }}: {{ scannedProduct?.states }}</p>
        <p>{{ 'QUANTITY' | translate }}: {{ scannedProduct?.quantity }}</p>
        <ion-button expand="block" (click)="addToFridge()">{{ 'ADD_TO_FRIDGE' | translate }}</ion-button>
      </ion-content>
    </ng-template>
  </ion-modal>

  <ion-modal #modalShared trigger="open-modal-shared">
    <ng-template>
      <div class="block">
        <ion-toolbar>
          <ion-title>Partager le frigo</ion-title>
          <ion-buttons slot="end">
            <ion-button color="light" (click)="modalShared.dismiss()">Close</ion-button>
          </ion-buttons>
        </ion-toolbar>

        <ion-list style="text-align:center">
          <ion-item>
            <ion-select id="category" cancelText="Cancel" okText="Ok" multiple="true" value=""
              placeholder="Selectionner un/des utilisateur(s)">
              <ion-select-option *ngFor="let item of usersResults" value="{{item.id}}">{{item.username}}
              </ion-select-option>

            </ion-select>
          </ion-item>
          <ion-button style="align-items: center;">{{ 'SHARED' | translate }}</ion-button>
        </ion-list>
      </div>
    </ng-template>
  </ion-modal>

  <ion-modal #modalAdd trigger="open-modal-add">
    <ng-template>
      <div class="block">
        <ion-toolbar>
          <ion-title>Ajouter un ingrédient</ion-title>
          <ion-buttons slot="end">
            <ion-button color="light" (click)="modalAdd.dismiss()">Close</ion-button>
          </ion-buttons>
        </ion-toolbar>
        <form name="form" (ngSubmit)="f.form.valid && onSubmit()" #f="ngForm" novalidate>
          <ion-list style="text-align:center">

            <ion-item>
              <input style="width: 100%;" class="sc-ion-input-ios-h sc-ion-input-ios-s ios input-label-placement-start in-item hydrated"
                list="browsers" placeholder="Entrer le nom de l'ingrédient" class="form-control" name="name" [(ngModel)]="form.name">


              <datalist id="browsers">
                <option value="Internet Explorer"></option>
                <option value="Firefox"></option>
                <option value="Chrome"></option>
                <option value="Opera"></option>
                <option value="Safari"></option>
              </datalist>

            </ion-item>

            <ion-item>
              <ion-input  inputmode="decimal" type="number" label="Quantity" placeholder="Enter quantity" class="form-control" name="quantity"
                [(ngModel)]="form.quantity"></ion-input>
            </ion-item>
            <ion-button style="align-items: center;" (click)="onSubmit()">Ajouter</ion-button>
          </ion-list>
        </form>
      </div>
    </ng-template>
  </ion-modal>

  <ion-alert trigger="present-alert"
    header="Etes vous sur de supprimer ce frigo ainsi que les ingrédients qu'il contient ?" [buttons]="alertButtons"
    (didDismiss)="setResult($event)"></ion-alert>

</ion-content>